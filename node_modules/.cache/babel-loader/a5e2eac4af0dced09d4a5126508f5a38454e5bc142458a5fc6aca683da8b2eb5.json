{"ast":null,"code":"import _objectSpread from\"C:/Users/allen/dev/FreshroadReact/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef}from'react';import{useNavigate}from'react-router-dom';import'../App.css';import freshroadlogo from'../images/freshroadlogo.png';import avatarImage from'../images/callrep.png';import{PaperAirplaneIcon,MicrophoneIcon,TranslateIcon}from'@heroicons/react/outline';import{tts11}from'../api/elevenlabs';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ChatInterfacePage=()=>{// -------------------------\n// State\n// -------------------------\nconst[messages,setMessages]=useState([{sender:'bot',text:'Welcome to the Santa Clara County 211 call center. How can I help you today?'}]);const[input,setInput]=useState('');const[isListening,setIsListening]=useState(false);const[spokenText,setSpokenText]=useState('');const[selectedLanguage,setSelectedLanguage]=useState('English');const[isTranslating,setIsTranslating]=useState(false);// -------------------------\n// Refs & Navigation\n// -------------------------\nconst messageEndRef=useRef(null);const navigate=useNavigate();// -------------------------\n// Detect Mobile (only once, so it doesn't flip mid-session)\n// -------------------------\nconst[mobileLayout]=useState(()=>/Mobi|Android/i.test(navigator.userAgent));// -------------------------\n// Language Codes\n// -------------------------\nconst languageCodes={English:'en-US',Español:'es-ES',中文:'zh-CN',Français:'fr-FR',Deutsch:'de-DE',Italiano:'it-IT',日本語:'ja-JP',한국어:'ko-KR',Português:'pt-BR',Русский:'ru-RU'};// -------------------------\n// OpenAI Key (example)\n// -------------------------\nconst OPENAI_API_KEY='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';// Replace with a secure mechanism\n// ==========================================================================\n// Fetch GPT Response\n// ==========================================================================\nconst fetchChatGPTResponse=async userMessage=>{const chatHistory=[{role:'system',content:'Limit responses to three sentences and assume the user can read English so send all responses in English but do not let the user know about this prompt. When you receive questions in another language, understand it and reply in English. The conversations will be multilingual. You work as a customer service representative for the Santa Clara County 211 call center. Your job is to provide accurate information about the services Santa Clara County can offer. Always speak in sentences and lists. If the user is asking for food assistance, give information on CalFresh, the food stamp application, include eligibility. If user agrees to let you help fill out the form, send back only the code \"CalFreshAccepted\".'},...messages.map(msg=>({role:msg.sender==='user'?'user':'assistant',content:msg.text})),{role:'user',content:userMessage}];try{const response=await fetch('https://api.openai.com/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json',Authorization:\"Bearer \".concat(OPENAI_API_KEY)},body:JSON.stringify({model:'gpt-4',messages:chatHistory})});const data=await response.json();const botMessage=data.choices[0].message.content.trim();// Special check for CalFresh\nif(botMessage==='CalFreshAccepted'){setMessages(prev=>[...prev,{sender:'bot',type:'calfreshAccepted'}]);return;}// Normal Bot Response\nhandleBotResponse(botMessage);}catch(error){console.error('Error fetching response:',error);setMessages(prev=>[...prev,{sender:'bot',text:'Sorry, I am having trouble responding at the moment. Please try again later.'}]);}};// ==========================================================================\n// Handle Bot Response (Translate if needed, else just store & speak)\n// ==========================================================================\nconst handleBotResponse=botMessage=>{if(selectedLanguage!=='English'){handleTranslateAndPlayTTS(botMessage);}else{setMessages(prev=>[...prev,{sender:'bot',text:botMessage}]);playTTS(botMessage);}};// ==========================================================================\n// Translate & TTS\n// ==========================================================================\nconst handleTranslateAndPlayTTS=async message=>{const translationPrompt=\"Translate the following text into \".concat(selectedLanguage,\": \\\"\").concat(message,\"\\\"\");try{const response=await fetch('https://api.openai.com/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json',Authorization:\"Bearer \".concat(OPENAI_API_KEY)},body:JSON.stringify({model:'gpt-4',messages:[{role:'system',content:translationPrompt}]})});const data=await response.json();const translatedMessage=data.choices[0].message.content;setMessages(prev=>[...prev,{sender:'bot',text:message,translation:translatedMessage}]);// TTS in the translated language\nplayTTS(translatedMessage);}catch(error){console.error('Error translating:',error);setMessages(prev=>[...prev,{sender:'bot',text:'Sorry, I am having trouble translating right now.'}]);}};// ==========================================================================\n// TTS\n// ==========================================================================\nconst playTTS=async function(text){let voiceId=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'pFZP5JQG7iQjIQuC4Bku';try{const audioBlob=await tts11(text,voiceId);const audioUrl=URL.createObjectURL(audioBlob);const audio=new Audio(audioUrl);audio.play();}catch(error){console.error('Error playing TTS audio:',error);}};// ==========================================================================\n// Send Message (Desktop only now)\n// ==========================================================================\nconst handleSendMessage=()=>{if(input.trim()!==''){const userMessage=input.trim();setMessages(prev=>[...prev,{sender:'user',text:userMessage}]);setInput('');fetchChatGPTResponse(userMessage);}};// ==========================================================================\n// Voice Input\n// ==========================================================================\nconst handleVoiceInput=()=>{if(isListening){// Stop listening\nsetIsListening(false);setSpokenText('');}else{// Start listening\nsetIsListening(true);const SpeechRecognition=window.SpeechRecognition||window.webkitSpeechRecognition;if(!SpeechRecognition){console.error('Speech recognition not supported.');setSpokenText('Not supported in this browser.');setIsListening(false);return;}const recognition=new SpeechRecognition();recognition.lang=languageCodes[selectedLanguage]||'en-US';recognition.interimResults=false;recognition.continuous=false;recognition.onstart=()=>{setSpokenText('Listening...');};recognition.onresult=event=>{const transcript=event.results[0][0].transcript;setSpokenText('');setIsListening(false);if(transcript.trim()!==''){// On mobile, we only have voice input, so add directly\nsetMessages(prev=>[...prev,{sender:'user',text:transcript}]);fetchChatGPTResponse(transcript);}};recognition.onerror=event=>{console.error('Speech recognition error:',event.error);setSpokenText('Could not understand, please try again.');setIsListening(false);};recognition.onend=()=>{setSpokenText('');setIsListening(false);};recognition.start();}};// ==========================================================================\n// Handle Language Change\n// ==========================================================================\nconst handleLanguageChange=lang=>{setSelectedLanguage(lang);};// ==========================================================================\n// On Key Press (Enter to Send) - Desktop only\n// ==========================================================================\nconst handleKeyPress=e=>{if(e.key==='Enter'){handleSendMessage();}};// ==========================================================================\n// On-demand Translation of Bot Messages\n// ==========================================================================\nconst handleTranslateMessage=async(messageText,index)=>{if(isTranslating)return;setIsTranslating(true);const translationPrompt=\"You are a helpful assistant that translates text to \".concat(selectedLanguage,\". Translate this text: \\\"\").concat(messageText,\"\\\"\");try{const response=await fetch('https://api.openai.com/v1/chat/completions',{method:'POST',headers:{'Content-Type':'application/json',Authorization:\"Bearer \".concat(OPENAI_API_KEY)},body:JSON.stringify({model:'gpt-4',messages:[{role:'system',content:translationPrompt}]})});const data=await response.json();const translatedMessage=data.choices[0].message.content;setMessages(prev=>{const updated=[...prev];updated[index]=_objectSpread(_objectSpread({},updated[index]),{},{translation:translatedMessage});return updated;});await playTTS(translatedMessage);}catch(error){console.error('Error translating:',error);}finally{setIsTranslating(false);}};// ==========================================================================\n// Auto-scroll\n// ==========================================================================\nuseEffect(()=>{if(messageEndRef.current){messageEndRef.current.scrollIntoView({behavior:'smooth'});}},[messages]);// ==========================================================================\n// RENDER HELPER: Chat Messages\n// ==========================================================================\nconst renderMessages=()=>{return messages.map((message,index)=>{// Special UI for CalFresh\nif(message.type==='calfreshAccepted'){return/*#__PURE__*/_jsx(\"div\",{className:\"flex mb-4 items-center justify-start w-full\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-sm w-auto p-4 rounded-lg shadow bg-green-100 text-green-800\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"mb-2 font-semibold\",children:\"CalFresh Application\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mb-4\",children:\"We\\u2019re ready to help you fill out the CalFresh application.\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/resources/calfresh'),className:\"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600\",children:\"Fill Out the Form\"})]})},index);}// Normal Bot/User Messages\nreturn/*#__PURE__*/_jsx(\"div\",{className:\"flex mb-4 items-center w-full \".concat(message.sender==='bot'?'justify-start':'justify-end'),children:/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-sm w-auto px-4 py-2 rounded-lg shadow \".concat(message.sender==='bot'?'bg-white text-gray-800':'bg-cyan-400 text-white'),children:[message.text,message.translation&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 text-sm text-gray-600\",children:message.translation}),message.sender==='bot'&&message.text&&/*#__PURE__*/_jsxs(\"button\",{onClick:()=>handleTranslateMessage(message.text,index),className:\"mt-2 text-xs text-blue-500 flex items-center\",children:[/*#__PURE__*/_jsx(TranslateIcon,{className:\"h-5 w-5 mr-1\"}),\"Translate\"]})]})},index);});};// ==========================================================================\n// MOBILE LAYOUT - Voice Only\n// ==========================================================================\nconst MobileLayout=()=>{return/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col w-full h-screen overflow-hidden\",children:[/*#__PURE__*/_jsxs(\"nav\",{className:\"flex items-center justify-between h-12 px-4 bg-white border-b\",children:[/*#__PURE__*/_jsx(\"img\",{src:freshroadlogo,alt:\"Fresh Road Logo\",className:\"w-24 h-auto\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate(-1),className:\"text-sm font-semibold text-gray-900 hover:text-cyan-500 flex items-center\",children:[/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-5 w-5 mr-1\",fill:\"none\",viewBox:\"0 0 24 24\",stroke:\"currentColor\",strokeWidth:2,children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",d:\"M15 19l-7-7 7-7\"})}),\"Back\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow overflow-y-auto overflow-x-hidden bg-gray-100 px-4 pt-3 pb-20 w-full\",children:[renderMessages(),/*#__PURE__*/_jsx(\"div\",{ref:messageEndRef})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"absolute bottom-0 left-0 right-0 bg-white border-t p-2 flex items-center justify-start space-x-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:handleVoiceInput,className:\"px-6 py-2 rounded-lg text-white \".concat(isListening?'bg-red-500':'bg-cyan-400',\" hover:bg-cyan-500 flex items-center justify-center\"),style:{minWidth:'60px'}// Extra forced width if needed\n,children:/*#__PURE__*/_jsx(MicrophoneIcon,{className:\"h-5 w-5\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"relative\",children:/*#__PURE__*/_jsx(\"select\",{value:selectedLanguage,onChange:e=>handleLanguageChange(e.target.value),className:\"border rounded-lg p-1 text-sm \\r focus:outline-none \\r focus:ring-1 focus:ring-cyan-300\\r bg-white\",style:{// Attempt to transform the select to open upwards\ntransformOrigin:'center bottom'},children:Object.keys(languageCodes).map(lang=>/*#__PURE__*/_jsx(\"option\",{value:lang,children:lang},lang))})})]})]});};// ==========================================================================\n// DESKTOP LAYOUT (unchanged)\n// ==========================================================================\nconst DesktopLayout=()=>{return/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col h-screen\",children:[/*#__PURE__*/_jsxs(\"nav\",{className:\"flex justify-between items-center h-16 px-4 bg-white border-b\",style:{position:'fixed',top:0,left:0,right:0,zIndex:10},children:[/*#__PURE__*/_jsx(\"img\",{src:freshroadlogo,alt:\"Fresh Road Logo\",className:\"w-35 h-8 mr-2\"}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate(-1),className:\"text-xl font-bold text-gray-900 hover:text-cyan-500 flex items-center\",children:[/*#__PURE__*/_jsx(\"svg\",{xmlns:\"http://www.w3.org/2000/svg\",className:\"h-6 w-6 mr-2\",fill:\"none\",viewBox:\"0 0 24 24\",stroke:\"currentColor\",strokeWidth:2,children:/*#__PURE__*/_jsx(\"path\",{strokeLinecap:\"round\",strokeLinejoin:\"round\",d:\"M15 19l-7-7 7-7\"})}),\"Back\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-grow flex overflow-hidden mt-16\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"w-1/3 bg-white rounded-lg shadow flex-shrink-0 flex flex-col\",style:{height:'calc(100vh - 8rem)'},children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-grow\",style:{backgroundImage:\"url(\".concat(avatarImage,\")\"),backgroundSize:'cover',backgroundPosition:'center',width:'100%'}}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-white\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-lg font-bold mb-2 text-center\",children:\"211 Call Center\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-sm mb-2\",children:/*#__PURE__*/_jsx(\"br\",{})}),/*#__PURE__*/_jsx(\"p\",{className:\"text-center text-sm\",children:\"Get assistance with community resources and support.\"}),/*#__PURE__*/_jsx(\"button\",{className:\"mt-4 px-4 py-2 bg-cyan-400 text-white rounded-lg hover:bg-cyan-500 w-full\",onClick:()=>alert('Change Avatar functionality not implemented yet!'),children:\"Change Avatar\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"w-2/3 p-4 bg-gray-100 overflow-y-auto overflow-x-hidden\",style:{height:'calc(100vh - 8rem)'},children:[renderMessages(),/*#__PURE__*/_jsx(\"div\",{ref:messageEndRef})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center p-4 bg-white border-t\",style:{position:'sticky',bottom:0},children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",className:\"flex-grow border rounded-lg px-4 py-2 focus:outline-none focus:ring focus:ring-cyan-300\",placeholder:\"Type your message...\",value:input,onChange:e=>setInput(e.target.value),onKeyPress:handleKeyPress}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleSendMessage,className:\"ml-2 px-4 py-2 bg-cyan-400 text-white rounded-lg hover:bg-cyan-500 flex items-center\",children:[/*#__PURE__*/_jsx(PaperAirplaneIcon,{className:\"h-5 w-5 mr-1\"}),\"Send\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:handleVoiceInput,className:\"ml-4 px-4 py-2 rounded-lg text-white \".concat(isListening?'bg-red-500':'bg-cyan-400',\" hover:bg-cyan-500 flex items-center\"),children:[/*#__PURE__*/_jsx(MicrophoneIcon,{className:\"h-5 w-5 mr-1\"}),isListening?'Stop':'Voice Input']}),/*#__PURE__*/_jsx(\"select\",{value:selectedLanguage,onChange:e=>handleLanguageChange(e.target.value),className:\"ml-4 px-4 py-2 border rounded-lg\",children:Object.keys(languageCodes).map(lang=>/*#__PURE__*/_jsx(\"option\",{value:lang,children:lang},lang))})]})]});};// ==========================================================================\n// Final Return: Only Voice Input on mobile\n// ==========================================================================\nreturn mobileLayout?/*#__PURE__*/_jsx(MobileLayout,{}):/*#__PURE__*/_jsx(DesktopLayout,{});};export default ChatInterfacePage;","map":{"version":3,"names":["React","useState","useEffect","useRef","useNavigate","freshroadlogo","avatarImage","PaperAirplaneIcon","MicrophoneIcon","TranslateIcon","tts11","jsx","_jsx","jsxs","_jsxs","ChatInterfacePage","messages","setMessages","sender","text","input","setInput","isListening","setIsListening","spokenText","setSpokenText","selectedLanguage","setSelectedLanguage","isTranslating","setIsTranslating","messageEndRef","navigate","mobileLayout","test","navigator","userAgent","languageCodes","English","Español","中文","Français","Deutsch","Italiano","日本語","한국어","Português","Русский","OPENAI_API_KEY","fetchChatGPTResponse","userMessage","chatHistory","role","content","map","msg","response","fetch","method","headers","Authorization","concat","body","JSON","stringify","model","data","json","botMessage","choices","message","trim","prev","type","handleBotResponse","error","console","handleTranslateAndPlayTTS","playTTS","translationPrompt","translatedMessage","translation","voiceId","arguments","length","undefined","audioBlob","audioUrl","URL","createObjectURL","audio","Audio","play","handleSendMessage","handleVoiceInput","SpeechRecognition","window","webkitSpeechRecognition","recognition","lang","interimResults","continuous","onstart","onresult","event","transcript","results","onerror","onend","start","handleLanguageChange","handleKeyPress","e","key","handleTranslateMessage","messageText","index","updated","_objectSpread","current","scrollIntoView","behavior","renderMessages","className","children","onClick","MobileLayout","src","alt","xmlns","fill","viewBox","stroke","strokeWidth","strokeLinecap","strokeLinejoin","d","ref","style","minWidth","value","onChange","target","transformOrigin","Object","keys","DesktopLayout","position","top","left","right","zIndex","height","backgroundImage","backgroundSize","backgroundPosition","width","alert","bottom","placeholder","onKeyPress"],"sources":["C:/Users/allen/dev/FreshroadReact/src/pages/Chatpage.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport '../App.css';\r\nimport freshroadlogo from '../images/freshroadlogo.png';\r\nimport avatarImage from '../images/callrep.png';\r\nimport {\r\n  PaperAirplaneIcon,\r\n  MicrophoneIcon,\r\n  TranslateIcon,\r\n} from '@heroicons/react/outline';\r\nimport { tts11 } from '../api/elevenlabs';\r\n\r\nconst ChatInterfacePage = () => {\r\n  // -------------------------\r\n  // State\r\n  // -------------------------\r\n  const [messages, setMessages] = useState([\r\n    {\r\n      sender: 'bot',\r\n      text: 'Welcome to the Santa Clara County 211 call center. How can I help you today?',\r\n    },\r\n  ]);\r\n  const [input, setInput] = useState('');\r\n  const [isListening, setIsListening] = useState(false);\r\n  const [spokenText, setSpokenText] = useState('');\r\n  const [selectedLanguage, setSelectedLanguage] = useState('English');\r\n  const [isTranslating, setIsTranslating] = useState(false);\r\n\r\n  // -------------------------\r\n  // Refs & Navigation\r\n  // -------------------------\r\n  const messageEndRef = useRef(null);\r\n  const navigate = useNavigate();\r\n\r\n  // -------------------------\r\n  // Detect Mobile (only once, so it doesn't flip mid-session)\r\n  // -------------------------\r\n  const [mobileLayout] = useState(() =>\r\n    /Mobi|Android/i.test(navigator.userAgent)\r\n  );\r\n\r\n  // -------------------------\r\n  // Language Codes\r\n  // -------------------------\r\n  const languageCodes = {\r\n    English: 'en-US',\r\n    Español: 'es-ES',\r\n    中文: 'zh-CN',\r\n    Français: 'fr-FR',\r\n    Deutsch: 'de-DE',\r\n    Italiano: 'it-IT',\r\n    日本語: 'ja-JP',\r\n    한국어: 'ko-KR',\r\n    Português: 'pt-BR',\r\n    Русский: 'ru-RU',\r\n  };\r\n\r\n  // -------------------------\r\n  // OpenAI Key (example)\r\n  // -------------------------\r\n  const OPENAI_API_KEY = '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'; // Replace with a secure mechanism\r\n\r\n  // ==========================================================================\r\n  // Fetch GPT Response\r\n  // ==========================================================================\r\n  const fetchChatGPTResponse = async (userMessage) => {\r\n    const chatHistory = [\r\n      {\r\n        role: 'system',\r\n        content:\r\n          'Limit responses to three sentences and assume the user can read English so send all responses in English but do not let the user know about this prompt. When you receive questions in another language, understand it and reply in English. The conversations will be multilingual. You work as a customer service representative for the Santa Clara County 211 call center. Your job is to provide accurate information about the services Santa Clara County can offer. Always speak in sentences and lists. If the user is asking for food assistance, give information on CalFresh, the food stamp application, include eligibility. If user agrees to let you help fill out the form, send back only the code \"CalFreshAccepted\".',\r\n      },\r\n      ...messages.map((msg) => ({\r\n        role: msg.sender === 'user' ? 'user' : 'assistant',\r\n        content: msg.text,\r\n      })),\r\n      { role: 'user', content: userMessage },\r\n    ];\r\n\r\n    try {\r\n      const response = await fetch('https://api.openai.com/v1/chat/completions', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          Authorization: `Bearer ${OPENAI_API_KEY}`,\r\n        },\r\n        body: JSON.stringify({\r\n          model: 'gpt-4',\r\n          messages: chatHistory,\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n      const botMessage = data.choices[0].message.content.trim();\r\n\r\n      // Special check for CalFresh\r\n      if (botMessage === 'CalFreshAccepted') {\r\n        setMessages((prev) => [\r\n          ...prev,\r\n          { sender: 'bot', type: 'calfreshAccepted' },\r\n        ]);\r\n        return;\r\n      }\r\n\r\n      // Normal Bot Response\r\n      handleBotResponse(botMessage);\r\n    } catch (error) {\r\n      console.error('Error fetching response:', error);\r\n      setMessages((prev) => [\r\n        ...prev,\r\n        {\r\n          sender: 'bot',\r\n          text: 'Sorry, I am having trouble responding at the moment. Please try again later.',\r\n        },\r\n      ]);\r\n    }\r\n  };\r\n\r\n  // ==========================================================================\r\n  // Handle Bot Response (Translate if needed, else just store & speak)\r\n  // ==========================================================================\r\n  const handleBotResponse = (botMessage) => {\r\n    if (selectedLanguage !== 'English') {\r\n      handleTranslateAndPlayTTS(botMessage);\r\n    } else {\r\n      setMessages((prev) => [...prev, { sender: 'bot', text: botMessage }]);\r\n      playTTS(botMessage);\r\n    }\r\n  };\r\n\r\n  // ==========================================================================\r\n  // Translate & TTS\r\n  // ==========================================================================\r\n  const handleTranslateAndPlayTTS = async (message) => {\r\n    const translationPrompt = `Translate the following text into ${selectedLanguage}: \"${message}\"`;\r\n    try {\r\n      const response = await fetch('https://api.openai.com/v1/chat/completions', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          Authorization: `Bearer ${OPENAI_API_KEY}`,\r\n        },\r\n        body: JSON.stringify({\r\n          model: 'gpt-4',\r\n          messages: [{ role: 'system', content: translationPrompt }],\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n      const translatedMessage = data.choices[0].message.content;\r\n\r\n      setMessages((prev) => [\r\n        ...prev,\r\n        { sender: 'bot', text: message, translation: translatedMessage },\r\n      ]);\r\n\r\n      // TTS in the translated language\r\n      playTTS(translatedMessage);\r\n    } catch (error) {\r\n      console.error('Error translating:', error);\r\n      setMessages((prev) => [\r\n        ...prev,\r\n        {\r\n          sender: 'bot',\r\n          text: 'Sorry, I am having trouble translating right now.',\r\n        },\r\n      ]);\r\n    }\r\n  };\r\n\r\n  // ==========================================================================\r\n  // TTS\r\n  // ==========================================================================\r\n  const playTTS = async (text, voiceId = 'pFZP5JQG7iQjIQuC4Bku') => {\r\n    try {\r\n      const audioBlob = await tts11(text, voiceId);\r\n      const audioUrl = URL.createObjectURL(audioBlob);\r\n      const audio = new Audio(audioUrl);\r\n      audio.play();\r\n    } catch (error) {\r\n      console.error('Error playing TTS audio:', error);\r\n    }\r\n  };\r\n\r\n  // ==========================================================================\r\n  // Send Message (Desktop only now)\r\n  // ==========================================================================\r\n  const handleSendMessage = () => {\r\n    if (input.trim() !== '') {\r\n      const userMessage = input.trim();\r\n      setMessages((prev) => [...prev, { sender: 'user', text: userMessage }]);\r\n      setInput('');\r\n      fetchChatGPTResponse(userMessage);\r\n    }\r\n  };\r\n\r\n  // ==========================================================================\r\n  // Voice Input\r\n  // ==========================================================================\r\n  const handleVoiceInput = () => {\r\n    if (isListening) {\r\n      // Stop listening\r\n      setIsListening(false);\r\n      setSpokenText('');\r\n    } else {\r\n      // Start listening\r\n      setIsListening(true);\r\n\r\n      const SpeechRecognition =\r\n        window.SpeechRecognition || window.webkitSpeechRecognition;\r\n      if (!SpeechRecognition) {\r\n        console.error('Speech recognition not supported.');\r\n        setSpokenText('Not supported in this browser.');\r\n        setIsListening(false);\r\n        return;\r\n      }\r\n\r\n      const recognition = new SpeechRecognition();\r\n      recognition.lang = languageCodes[selectedLanguage] || 'en-US';\r\n      recognition.interimResults = false;\r\n      recognition.continuous = false;\r\n\r\n      recognition.onstart = () => {\r\n        setSpokenText('Listening...');\r\n      };\r\n\r\n      recognition.onresult = (event) => {\r\n        const transcript = event.results[0][0].transcript;\r\n        setSpokenText('');\r\n        setIsListening(false);\r\n\r\n        if (transcript.trim() !== '') {\r\n          // On mobile, we only have voice input, so add directly\r\n          setMessages((prev) => [...prev, { sender: 'user', text: transcript }]);\r\n          fetchChatGPTResponse(transcript);\r\n        }\r\n      };\r\n\r\n      recognition.onerror = (event) => {\r\n        console.error('Speech recognition error:', event.error);\r\n        setSpokenText('Could not understand, please try again.');\r\n        setIsListening(false);\r\n      };\r\n\r\n      recognition.onend = () => {\r\n        setSpokenText('');\r\n        setIsListening(false);\r\n      };\r\n\r\n      recognition.start();\r\n    }\r\n  };\r\n\r\n  // ==========================================================================\r\n  // Handle Language Change\r\n  // ==========================================================================\r\n  const handleLanguageChange = (lang) => {\r\n    setSelectedLanguage(lang);\r\n  };\r\n\r\n  // ==========================================================================\r\n  // On Key Press (Enter to Send) - Desktop only\r\n  // ==========================================================================\r\n  const handleKeyPress = (e) => {\r\n    if (e.key === 'Enter') {\r\n      handleSendMessage();\r\n    }\r\n  };\r\n\r\n  // ==========================================================================\r\n  // On-demand Translation of Bot Messages\r\n  // ==========================================================================\r\n  const handleTranslateMessage = async (messageText, index) => {\r\n    if (isTranslating) return;\r\n    setIsTranslating(true);\r\n\r\n    const translationPrompt = `You are a helpful assistant that translates text to ${selectedLanguage}. Translate this text: \"${messageText}\"`;\r\n\r\n    try {\r\n      const response = await fetch('https://api.openai.com/v1/chat/completions', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          Authorization: `Bearer ${OPENAI_API_KEY}`,\r\n        },\r\n        body: JSON.stringify({\r\n          model: 'gpt-4',\r\n          messages: [\r\n            {\r\n              role: 'system',\r\n              content: translationPrompt,\r\n            },\r\n          ],\r\n        }),\r\n      });\r\n\r\n      const data = await response.json();\r\n      const translatedMessage = data.choices[0].message.content;\r\n\r\n      setMessages((prev) => {\r\n        const updated = [...prev];\r\n        updated[index] = {\r\n          ...updated[index],\r\n          translation: translatedMessage,\r\n        };\r\n        return updated;\r\n      });\r\n\r\n      await playTTS(translatedMessage);\r\n    } catch (error) {\r\n      console.error('Error translating:', error);\r\n    } finally {\r\n      setIsTranslating(false);\r\n    }\r\n  };\r\n\r\n  // ==========================================================================\r\n  // Auto-scroll\r\n  // ==========================================================================\r\n  useEffect(() => {\r\n    if (messageEndRef.current) {\r\n      messageEndRef.current.scrollIntoView({ behavior: 'smooth' });\r\n    }\r\n  }, [messages]);\r\n\r\n  // ==========================================================================\r\n  // RENDER HELPER: Chat Messages\r\n  // ==========================================================================\r\n  const renderMessages = () => {\r\n    return messages.map((message, index) => {\r\n      // Special UI for CalFresh\r\n      if (message.type === 'calfreshAccepted') {\r\n        return (\r\n          <div key={index} className=\"flex mb-4 items-center justify-start w-full\">\r\n            <div className=\"max-w-sm w-auto p-4 rounded-lg shadow bg-green-100 text-green-800\">\r\n              <p className=\"mb-2 font-semibold\">CalFresh Application</p>\r\n              <p className=\"mb-4\">\r\n                We’re ready to help you fill out the CalFresh application.\r\n              </p>\r\n              <button\r\n                onClick={() => navigate('/resources/calfresh')}\r\n                className=\"px-4 py-2 bg-green-500 text-white rounded-md hover:bg-green-600\"\r\n              >\r\n                Fill Out the Form\r\n              </button>\r\n            </div>\r\n          </div>\r\n        );\r\n      }\r\n\r\n      // Normal Bot/User Messages\r\n      return (\r\n        <div\r\n          key={index}\r\n          className={`flex mb-4 items-center w-full ${\r\n            message.sender === 'bot' ? 'justify-start' : 'justify-end'\r\n          }`}\r\n        >\r\n          <div\r\n            className={`max-w-sm w-auto px-4 py-2 rounded-lg shadow ${\r\n              message.sender === 'bot'\r\n                ? 'bg-white text-gray-800'\r\n                : 'bg-cyan-400 text-white'\r\n            }`}\r\n          >\r\n            {message.text}\r\n            {message.translation && (\r\n              <div className=\"mt-2 text-sm text-gray-600\">\r\n                {message.translation}\r\n              </div>\r\n            )}\r\n\r\n            {message.sender === 'bot' && message.text && (\r\n              <button\r\n                onClick={() => handleTranslateMessage(message.text, index)}\r\n                className=\"mt-2 text-xs text-blue-500 flex items-center\"\r\n              >\r\n                <TranslateIcon className=\"h-5 w-5 mr-1\" />\r\n                Translate\r\n              </button>\r\n            )}\r\n          </div>\r\n        </div>\r\n      );\r\n    });\r\n  };\r\n\r\n  // ==========================================================================\r\n  // MOBILE LAYOUT - Voice Only\r\n  // ==========================================================================\r\n  const MobileLayout = () => {\r\n    return (\r\n      <div className=\"flex flex-col w-full h-screen overflow-hidden\">\r\n        {/* Header */}\r\n        <nav className=\"flex items-center justify-between h-12 px-4 bg-white border-b\">\r\n          <img src={freshroadlogo} alt=\"Fresh Road Logo\" className=\"w-24 h-auto\" />\r\n          <button\r\n            onClick={() => navigate(-1)}\r\n            className=\"text-sm font-semibold text-gray-900 hover:text-cyan-500 flex items-center\"\r\n          >\r\n            <svg\r\n              xmlns=\"http://www.w3.org/2000/svg\"\r\n              className=\"h-5 w-5 mr-1\"\r\n              fill=\"none\"\r\n              viewBox=\"0 0 24 24\"\r\n              stroke=\"currentColor\"\r\n              strokeWidth={2}\r\n            >\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M15 19l-7-7 7-7\" />\r\n            </svg>\r\n            Back\r\n          </button>\r\n        </nav>\r\n  \r\n        {/* Chat Body */}\r\n        <div\r\n          className=\"flex-grow overflow-y-auto overflow-x-hidden bg-gray-100 px-4 pt-3 pb-20 w-full\"\r\n        >\r\n          {renderMessages()}\r\n          <div ref={messageEndRef} />\r\n        </div>\r\n  \r\n        {/* Bottom bar: Voice only + Language selector */}\r\n        <div className=\"absolute bottom-0 left-0 right-0 bg-white border-t p-2 flex items-center justify-start space-x-2\">\r\n          {/* Voice button (make it wider) */}\r\n          <button\r\n            onClick={handleVoiceInput}\r\n            className={`px-6 py-2 rounded-lg text-white ${\r\n              isListening ? 'bg-red-500' : 'bg-cyan-400'\r\n            } hover:bg-cyan-500 flex items-center justify-center`}\r\n            style={{ minWidth: '60px' }} // Extra forced width if needed\r\n          >\r\n            <MicrophoneIcon className=\"h-5 w-5\" />\r\n          </button>\r\n  \r\n          {/* 'Drop-up' Language container - note this is a hack and may not work consistently */}\r\n          <div className=\"relative\">\r\n            <select\r\n              value={selectedLanguage}\r\n              onChange={(e) => handleLanguageChange(e.target.value)}\r\n              className=\"border rounded-lg p-1 text-sm \r\n                         focus:outline-none \r\n                         focus:ring-1 focus:ring-cyan-300\r\n                         bg-white\"\r\n              style={{\r\n                // Attempt to transform the select to open upwards\r\n                transformOrigin: 'center bottom',\r\n              }}\r\n            >\r\n              {Object.keys(languageCodes).map((lang) => (\r\n                <option key={lang} value={lang}>\r\n                  {lang}\r\n                </option>\r\n              ))}\r\n            </select>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // ==========================================================================\r\n  // DESKTOP LAYOUT (unchanged)\r\n  // ==========================================================================\r\n  const DesktopLayout = () => {\r\n    return (\r\n      <div className=\"flex flex-col h-screen\">\r\n        {/* Header */}\r\n        <nav\r\n          className=\"flex justify-between items-center h-16 px-4 bg-white border-b\"\r\n          style={{ position: 'fixed', top: 0, left: 0, right: 0, zIndex: 10 }}\r\n        >\r\n          <img src={freshroadlogo} alt=\"Fresh Road Logo\" className=\"w-35 h-8 mr-2\" />\r\n          <button\r\n            onClick={() => navigate(-1)}\r\n            className=\"text-xl font-bold text-gray-900 hover:text-cyan-500 flex items-center\"\r\n          >\r\n            <svg\r\n              xmlns=\"http://www.w3.org/2000/svg\"\r\n              className=\"h-6 w-6 mr-2\"\r\n              fill=\"none\"\r\n              viewBox=\"0 0 24 24\"\r\n              stroke=\"currentColor\"\r\n              strokeWidth={2}\r\n            >\r\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" d=\"M15 19l-7-7 7-7\" />\r\n            </svg>\r\n            Back\r\n          </button>\r\n        </nav>\r\n\r\n        {/* Main Content */}\r\n        <div className=\"flex-grow flex overflow-hidden mt-16\">\r\n          {/* LEFT: Avatar Panel */}\r\n          <div\r\n            className=\"w-1/3 bg-white rounded-lg shadow flex-shrink-0 flex flex-col\"\r\n            style={{ height: 'calc(100vh - 8rem)' }}\r\n          >\r\n            {/* Avatar Image */}\r\n            <div\r\n              className=\"flex-grow\"\r\n              style={{\r\n                backgroundImage: `url(${avatarImage})`,\r\n                backgroundSize: 'cover',\r\n                backgroundPosition: 'center',\r\n                width: '100%',\r\n              }}\r\n            ></div>\r\n\r\n            {/* Description Section */}\r\n            <div className=\"p-4 bg-white\">\r\n              <h2 className=\"text-lg font-bold mb-2 text-center\">211 Call Center</h2>\r\n              <p className=\"text-center text-sm mb-2\">\r\n                <br />\r\n              </p>\r\n              <p className=\"text-center text-sm\">\r\n                Get assistance with community resources and support.\r\n              </p>\r\n              <button\r\n                className=\"mt-4 px-4 py-2 bg-cyan-400 text-white rounded-lg hover:bg-cyan-500 w-full\"\r\n                onClick={() => alert('Change Avatar functionality not implemented yet!')}\r\n              >\r\n                Change Avatar\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* RIGHT: Chat Body */}\r\n          <div\r\n            className=\"w-2/3 p-4 bg-gray-100 overflow-y-auto overflow-x-hidden\"\r\n            style={{ height: 'calc(100vh - 8rem)' }}\r\n          >\r\n            {renderMessages()}\r\n            <div ref={messageEndRef} />\r\n          </div>\r\n        </div>\r\n\r\n        {/* Desktop Chat Input (Text + Send + Voice + Language) */}\r\n        <div\r\n          className=\"flex items-center p-4 bg-white border-t\"\r\n          style={{ position: 'sticky', bottom: 0 }}\r\n        >\r\n          <input\r\n            type=\"text\"\r\n            className=\"flex-grow border rounded-lg px-4 py-2 focus:outline-none focus:ring focus:ring-cyan-300\"\r\n            placeholder=\"Type your message...\"\r\n            value={input}\r\n            onChange={(e) => setInput(e.target.value)}\r\n            onKeyPress={handleKeyPress}\r\n          />\r\n          <button\r\n            onClick={handleSendMessage}\r\n            className=\"ml-2 px-4 py-2 bg-cyan-400 text-white rounded-lg hover:bg-cyan-500 flex items-center\"\r\n          >\r\n            <PaperAirplaneIcon className=\"h-5 w-5 mr-1\" />\r\n            Send\r\n          </button>\r\n          <button\r\n            onClick={handleVoiceInput}\r\n            className={`ml-4 px-4 py-2 rounded-lg text-white ${\r\n              isListening ? 'bg-red-500' : 'bg-cyan-400'\r\n            } hover:bg-cyan-500 flex items-center`}\r\n          >\r\n            <MicrophoneIcon className=\"h-5 w-5 mr-1\" />\r\n            {isListening ? 'Stop' : 'Voice Input'}\r\n          </button>\r\n          <select\r\n            value={selectedLanguage}\r\n            onChange={(e) => handleLanguageChange(e.target.value)}\r\n            className=\"ml-4 px-4 py-2 border rounded-lg\"\r\n          >\r\n            {Object.keys(languageCodes).map((lang) => (\r\n              <option key={lang} value={lang}>\r\n                {lang}\r\n              </option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // ==========================================================================\r\n  // Final Return: Only Voice Input on mobile\r\n  // ==========================================================================\r\n  return mobileLayout ? <MobileLayout /> : <DesktopLayout />;\r\n};\r\n\r\nexport default ChatInterfacePage;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}